<script src="//julesfouchy.github.io/p5.js-widget/p5-widget.js"></script>

<script>
    const isInViewport = (rect) => rect.top >= 0 && rect.bottom <= window.innerHeight

    function debounce(func, timeout = 300){
        let timer;
        return (...args) => {
            clearTimeout(timer)
            timer = setTimeout(() => { func.apply(this, args); }, timeout)
        }
    }

    window.addEventListener('load', () => {
        const hs = [...document.querySelectorAll("#content h1, #content h2, #content h3,  #content h4")]
        const refs = new Map([...document.querySelectorAll("#toc [href]")].map(a => [a.getAttribute("href").substring(1), a]))
        const refAs = [...refs.values()]

        document.addEventListener('scroll', debounce(() => {
            refAs.forEach(a => a.classList.remove('in-view'))
            const h = hs.find(r => isInViewport(r.getBoundingClientRect()))

            if(h){
                refs.get(h.getAttribute('id')).classList.add('in-view')
            }
        }, 200))
    })
</script>